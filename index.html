<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>playlist</title>
    <style>
      body {
        background: black;
        color: lime;
        font-family: monospace;
      }
      th {
        text-align: left;
      }
      th:not(:first-child),
      td:not(:first-child) {
        padding-left: 2em;
      }
    </style>
  </head>

  <body>
    <table>
      <thead id="columns"></thead>
      <tbody id="rows">
        <tr>
          <td>Loading...</td>
        </tr>
      </tbody>
    </table>
    <script type="module">
      const res = await fetch("./tracks.json");
      const tracks = await res.json();
      const columnsEl = document.getElementById("columns");
      const rowsEl = document.getElementById("rows");

      const columns = {
        artists: "Artist(s)",
        title: "Title",
        addedAt: "Added On",
      };

      Object.entries(columns).forEach(([key, value]) => {
        const th = document.createElement("th");
        th.innerHTML = value;
        columnsEl.appendChild(th);
      });

      const parse = (key, value) =>
        ((
          {
            artists: (value) => value.join(", "),
            addedAt: (value) => new Date(value).toISOString().slice(0, 10),
          }[key] || ((value) => value)
        )(value));

      const trackEls = [];
      tracks.forEach((track) => {
        const tr = document.createElement("tr");
        Object.keys(columns).forEach((key) => {
          const td = document.createElement("td");
          td.innerHTML = parse(key, track[key]);
          tr.appendChild(td);
        });
        trackEls.push(tr);
      });
      rowsEl.replaceChildren(...trackEls);
    </script>
  </body>
</html>
